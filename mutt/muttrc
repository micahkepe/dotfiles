# vim: filetype=neomuttrc
source /usr/local/share/mutt-wizard/mutt-wizard.muttrc
source $HOME/.config/mutt/accounts/micahkepe@gmail.com.muttrc

set header_cache_backend = "lmdb"
set sort = reverse-date

# PGP Signing
set pgp_default_key = 0CA0E777FE959BE23D99563A290BC0FA832F2CBF

# Appearance
color normal		  default default         # Text is "Text"
color index		    color2 default ~N       # New Messages are Green
color index		    color1 default ~F       # Flagged messages are Red
color index		    color13 default ~T      # Tagged Messages are Red
color index		    color1 default ~D       # Messages to delete are Red
color attachment	color5 default          # Attachments are Pink
color signature	  color8 default          # Signatures are Surface 2
color search		  color4 default          # Highlighted results are Blue

color indicator		default color8          # currently highlighted message Surface 2=Background Text=Foreground
color error		    color1 default          # error messages are Red
color status		  color15 default         # status line "Subtext 0"
color tree        color15 default         # thread tree arrows Subtext 0
color tilde       color15 default         # blank line padding Subtext 0

color hdrdefault  color13 default         # default headers Pink
color header		  color13 default "^From:"
color header	 	  color13 default "^Subject:"

color quoted		  color15 default         # Subtext 0
color quoted1		  color7 default          # Subtext 1
color quoted2		  color8 default          # Surface 2
color quoted3		  color0 default          # Surface 1
color quoted4		  color0 default
color quoted5		  color0 default

color body		color2 default		[\-\.+_a-zA-Z0-9]+@[\-\.a-zA-Z0-9]+               # email addresses Green
color body	  color2 default		(https?|ftp)://[\-\.,/%~_:?&=\#a-zA-Z0-9]+        # URLs Green
color body		color4 default		(^|[[:space:]])\\*[^[:space:]]+\\*([[:space:]]|$) # *bold* text Blue
color body		color4 default		(^|[[:space:]])_[^[:space:]]+_([[:space:]]|$)     # _underlined_ text Blue
color body		color4 default		(^|[[:space:]])/[^[:space:]]+/([[:space:]]|$)     # /italic/ text Blue

color sidebar_flagged   color1 default    # Mailboxes with flagged mails are Red
color sidebar_new       color10 default   # Mailboxes with new mail are Green

# Appearance
set sidebar_format = "%D %?F? ?%?N? ?%!%n"

# Macros
macro index,pager i1 '<sync-mailbox><enter-command>source $HOME/.config/mutt/accounts/micahkepe@gmail.com.muttrc<enter><change-folder>!<enter>;<check-stats>' "switch to micahkepe@gmail.com"

# Only show last 30 days of emails on startup
set auto_tag = yes
folder-hook . 'push <limit>~d<30d<enter>'

# Don't save sent messages locally
set record=""

# Enable notmuch
set nm_default_url = "notmuch://$HOME/.local/share/mail/micahkepe@gmail.com"
set nm_db_limit = 5000
set virtual_spoolfile = yes
set nm_record = yes
set nm_record_tags = "-inbox,sent"
set mbox_type = Maildir

set spoolfile = "Inbox"
virtual-mailboxes "Inbox" "notmuch://?query=(tag:inbox -tag:promotions -tag:social) OR (tag:inbox and tag:flagged)"
virtual-mailboxes "Archive" "notmuch://?query=not tag:inbox and not tag:spam"
virtual-mailboxes "Personal" "notmuch://?query=tag:personal"
virtual-mailboxes "Flagged" "notmuch://?query=tag:flagged"
virtual-mailboxes "Promotions" "notmuch://?query=tag:promotions"
virtual-mailboxes "Social" "notmuch://?query=tag:social"
virtual-mailboxes "Sent" "notmuch://?query=tag:sent"

set sendmail = "gmi send -t -C $HOME/.local/share/mail/micahkepe@gmail.com"
macro index o "<shell-escape>cd $HOME/.local/share/mail/micahkepe@gmail.com && gmi sync<enter>" "run lieer to sync"

# Keybindings for notmuch
macro index,pager S "<vfolder-from-query>" "notmuch search"
macro index,pager + "<modify-labels>+*<return>" "add tag"
macro index,pager - "<modify-labels>-*<return>" "remove tag"

# Quick navigation to virtual folders
macro index,pager gi "<change-vfolder>Inbox<enter>" "go to recent inbox"
macro index,pager ga "<change-vfolder>Archive<enter>" "go to archive"
macro index,pager gf "<change-vfolder>Flagged<enter>" "go to flagged"
macro index,pager gs "<change-vfolder>Sent<enter>" "go to sent"

# Quick find
macro index \Cf "<vfolder-from-query>" "show only messages matching a notmuch pattern"

# URLs
macro index,pager \cb "<pipe-message> urlview<Enter>" "extract URLs out of a message"
macro attach,compose \cb "<pipe-entry> urlsview<Enter>" "extract URLs out of a message"

# Better date formatting
set index_format='%4C %Z %<[y?%<[m?%<[d?%[%l:%M%p ]&%[%a %d ]>&%[%b %d ]>&%[%m/%y ]> %-15.15L %s %g'
